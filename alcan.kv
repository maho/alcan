#:import defs defs
#:import Vec2d cymunk.Vec2d
#:import pi math.pi

<GameOver>
    size: 800, 271
    angle: 0
    momentum: 10**8
    mass: 1000

    canvas:
        PushMatrix
        Rotate:
            angle: root.angle
            origin: self.center
        Rectangle:
            pos: self.pos
            size: self.size
            source: 'img/gameover.png'
        PopMatrix

<Wizard>:
    size: 78, 98

    canvas:
        Rectangle:
            pos: self.pos
            size: self.size
            source: 'img/wizard.png'

<Element>:
    size: 40, 40
    imgsrc: None
    activated: False

    canvas:

        Color:
            rgba: (0.0, 0.9, 0.5, 1.0) if root.activated else (1.0, 1.0, 1.0, 1.0)

        Ellipse:
            pos: self.pos
            size: self.size

        Rectangle:
            pos: self.pos
            size: self.size
            source: root.imgsrc

<Platform>:
    size: 400, 50
    angle: 0
    momentum:  10**6
    
    canvas:

        PushMatrix

        Rotate:
            angle: root.angle
            origin: self.center
            
        Color: 
            rgba: (0., 1., 1., 0.8)
        Rectangle:
            pos: self.pos
            size: self.size

        PopMatrix

<Beam>:
    size: 50, 50
    friction: 44

    canvas:
        Color:
            rgba: (0., 1., 1.0, 0.8)
        Ellipse:
            pos: self.pos
            size: self.size

<Cannon>:
    size: 100, 100
    aim: 0

    offset: 0, -25

    canvas:
        PushMatrix
        Rotate
            angle: root.aim
            origin: Vec2d(self.center) + Vec2d(self.offset)

        Rectangle:
            pos: root.pos
            size: self.size
            source: "img/cannon.png"

        PopMatrix

<Explosion>:
    size: 100, 100
    frame: 1
    canvas:
        Rectangle:
            pos: root.pos
            size: self.size
            source: "img/explosion%02d.png"%root.frame


<Baloon>:
    canvas:
        Color:
            rgba: 0,0,0, 0.5
        Line:
            width: 3
            ellipse: [root.pos[0] - 20, root.pos[1] - 20, root.size[0] + 40, root.size[1] + 40]
        Line:
            points: [root.center[0], root.center[1] - 20] + root.anchor 
            width: 2
        #Color:
        #    rgba: (1, 1, 1, 1)
        #Ellipse: 
        #    pos: root.pos
        #    size: root.size

    anchor: (0, 0)
    text: "..."
    lab: lab
    size: self.lab.texture_size

    Label:
        id: lab
        halign: 'center'
        size: self.texture_size
        pos: root.pos
        text: root.text
        color: 0,0,0,1


<AlcanGame>:
    
    canvas:
        Scale:
            xyz: (root.scale, root.scale, root.scale)
        Rectangle:
            pos: self.pos
            size: defs.map_size
            source: 'img/bg.jpg'

    wizard: wizard
    cannon: cannon
    scale: 1.0
    bfs: 'inf'

    FloatLayout:
        pos: root.pos
        size: root.size
        size_hint: None, None 

        StackLayout:
            pos: self.parent.pos
            size: self.parent.size
            size_hint: None, None 
            
            Label: 
                text: "Steps to invent dragon: %s"%root.bfs
                size_hint: None, None
                size: 300, 50
            



    Cannon:
        id: cannon
        pos: 400, 100
        mass: None
        momentum: None 

    Wizard:
        id: wizard
        pos: 300, 100

    Platform:
        center: 1000,150
        size: 500, 45
        mass: 100

    Platform: 
        pos: 0,-100
        size: 500, 190
        mass: None
        momentum: None

    Beam:
        mass: None
        momentum: None
        center: 1000, 70
    Beam:
        mass: None
        momentum: None
        center: 1250, 70


<Label>:
    color: (0, 0, 0, 1)
